<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Crash Game Spaceman - Admin Edition</title>
    <style>
        body { background: #0b0e11; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Panel Atas: Saldo & Info */
        .stats-bar { display: flex; gap: 20px; margin-bottom: 10px; background: #1a1f26; padding: 15px 30px; border-radius: 10px; border: 1px solid #333; width: 540px; justify-content: space-between; }
        #balance-display { color: #ffc107; font-weight: bold; }

        /* Area Game */
        .game-container { position: relative; width: 600px; height: 350px; background: radial-gradient(circle, #1e2630 0%, #0b0e11 100%); border: 2px solid #333; border-radius: 15px; overflow: hidden; }
        canvas { width: 100%; height: 100%; }
        .multiplier-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        #multiplier { font-size: 5rem; font-weight: bold; color: #00ff00; text-shadow: 0 0 20px rgba(0,255,0,0.3); }

        /* Panel Kontrol Pemain */
        .controls { margin-top: 20px; background: #1a1f26; padding: 20px; border-radius: 12px; display: flex; gap: 15px; align-items: center; border: 1px solid #333; }
        input[type="number"] { padding: 10px; border-radius: 5px; border: 1px solid #444; background: #0b0e11; color: white; width: 100px; }
        button { padding: 12px 25px; font-size: 1rem; cursor: pointer; border: none; border-radius: 5px; background: #28a745; color: white; font-weight: bold; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        button:disabled { background: #444; cursor: not-allowed; }

        /* PANEL ADMIN (POJOK KANAN) */
        .admin-panel { position: fixed; top: 20px; right: 20px; background: rgba(255, 0, 0, 0.1); border: 1px solid #ff4444; padding: 15px; border-radius: 8px; width: 200px; }
        .admin-panel h4 { margin: 0 0 10px 0; color: #ff4444; font-size: 14px; text-transform: uppercase; }
        .admin-panel label { font-size: 11px; color: #ccc; }
        #nextCrashInput { width: 90%; margin-top: 5px; border: 1px solid #ff4444; }
        .debug-info { margin-top: 10px; font-size: 12px; color: #00ff00; }
    </style>
</head>
<body>

    <div class="admin-panel">
        <h4>Admin Control</h4>
        <label>Set Crash Ronde Depan:</label>
        <input type="number" id="nextCrashInput" step="0.01" placeholder="Auto (RNG)">
        <div class="debug-info">Bocoran Crash: <span id="debugVal">?</span></div>
    </div>

    <div class="stats-bar">
        <div>SALDO: <span id="balance-display">Rp 1,000,000</span></div>
        <div id="status-text" style="font-size: 12px; color: #888;">Menunggu taruhan...</div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        <div class="multiplier-overlay">
            <div id="multiplier">1.00x</div>
        </div>
    </div>

    <div class="controls">
        <div style="display:flex; flex-direction:column;">
            <label style="font-size:11px; color:#888; margin-bottom:4px;">BET AMOUNT</label>
            <input type="number" id="betInput" value="10000">
        </div>
        <button id="actionBtn">PASANG TARUHAN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const multDisplay = document.getElementById('multiplier');
        const actionBtn = document.getElementById('actionBtn');
        const balanceDisplay = document.getElementById('balance-display');
        const nextCrashInput = document.getElementById('nextCrashInput');
        const debugVal = document.getElementById('debugVal');

        canvas.width = 600;
        canvas.height = 350;

        // Data Dasar
        let balance = 1000000;
        let currentBet = 0;
        let gameState = 'WAITING'; 
        let multiplier = 1.00;
        let crashPoint = 0;
        let startTime = 0;
        let points = [];

        // Fungsi Initialization (PENTING: Ini yang menyiapkan ronde baru)
        function initRonde() {
            gameState = 'WAITING';
            multiplier = 1.00;
            points = [];
            
            // Logika RNG vs Admin Setting
            let settingManual = parseFloat(nextCrashInput.value);
            if (settingManual > 1) {
                crashPoint = settingManual;
                nextCrashInput.value = ""; // hapus setelah dibaca
            } else {
                // Rumus RNG Standar
                crashPoint = (0.99/ (1 - Math.random())).toFixed(2);
                if (crashPoint < 1) crashPoint = 1.00;
            }

            // Update Tampilan UI
            multDisplay.innerText = "1.00x";
            multDisplay.style.color = "#00ff00";
            actionBtn.disabled = false;
            actionBtn.innerText = "PASANG TARUHAN";
            actionBtn.style.background = "#28a745";
            debugVal.innerText = crashPoint + "x"; // Bocoran buat admin
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            if (gameState === 'FLYING' || gameState === 'CASHED_OUT') {
                const elapsed = (Date.now() - startTime) / 1000;
                
                // Rumus kenaikan angka
                multiplier = Math.pow(1.10, elapsed * 1.5); 
                multDisplay.innerText = multiplier.toFixed(2) + "x";

                // Koordinat grafik
                let x = elapsed * 60;
                let y = canvas.height - (multiplier * 20);
                points.push({x, y});

                // Cek Crash Realtime
                if (multiplier >= crashPoint) {
                    gameState = 'CRASHED';
                    multDisplay.style.color = "#ff4444";
                    multDisplay.innerText = "CRASH " + multiplier.toFixed(2) + "x";
                    actionBtn.disabled = true;
                    
                    // Otomatis mulai ronde baru dalam 3 detik
                    setTimeout(initRonde, 3000);
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (points.length > 1) {
                ctx.beginPath();
                ctx.strokeStyle = (gameState === 'CRASHED') ? 'red' : '#00ff00';
                ctx.lineWidth = 4;
                ctx.moveTo(0, canvas.height);
                points.forEach(p => ctx.lineTo(p.x, p.y));
                ctx.stroke();

                // Efek kursor di ujung
                const last = points[points.length - 1];
                ctx.fillStyle = "white";
                ctx.shadowBlur = 10;
                ctx.shadowColor = "white";
                ctx.beginPath();
                ctx.arc(last.x, last.y, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        actionBtn.addEventListener('click', () => {
            if (gameState === 'WAITING') {
                currentBet = parseInt(document.getElementById('betInput').value);
                if (currentBet > balance || currentBet <= 0) {
                    alert("Saldo tidak cukup!");
                    return;
                }

                balance -= currentBet;
                balanceDisplay.innerText = "Rp " + balance.toLocaleString();
                
                gameState = 'FLYING';
                startTime = Date.now();
                actionBtn.innerText = "CASH OUT";
                actionBtn.style.background = "#ffc107";

            } else if (gameState === 'FLYING') {
                // Proses Menang
                let winAmount = Math.floor(currentBet * multiplier);
                balance += winAmount;
                balanceDisplay.innerText = "Rp " + balance.toLocaleString();
                
                gameState = 'CASHED_OUT'; // Masih terbang tapi sudah WD
                actionBtn.disabled = true;
                actionBtn.innerText = "MENANG!";
            }
        });

        // Jalankan Inisialisasi Pertama
        initRonde();
        gameLoop();
    </script>
</body>
</html>